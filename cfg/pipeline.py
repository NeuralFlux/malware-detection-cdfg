import os
import sys

from cfg_building import CFGBuilder as CB
from feat_extraction import FeatureExtractor as FE

from tqdm import tqdm

if __name__ == "__main__":
    CLASS_DICT = {'b_samples': 0, 'hm_dojass3_samples': 1}
    SAMPLES_TYPE = sys.argv[1]

    for file_dir in tqdm(os.listdir(SAMPLES_TYPE)):
        # get file name
        file_name = file_dir[5:]

        # extract CFGs and features
        cb = CB('/'.join([SAMPLES_TYPE, file_dir, 'graphs/']))
        fe = FE(cb.func_graph_dict)
        fe.export_features(file_name, CLASS_DICT[SAMPLES_TYPE])